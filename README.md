# bankruptcy_scoring
 bankruptcy_scoring

### Структура проекта

```bash
bankruptcy_scoring/
├── app/                      # Основной код приложения
│   ├── __init__.py
│   ├── main.py               # FastAPI приложение (точка входа)
│   ├── config.py             # Конфигурация приложения
│   ├── database.py           # Работа с базой данных
│   ├── models.py             # Модели данных (SQLAlchemy)
│   ├── normalization.py      # Нормализация CSV данных
│   ├── scoring.py            # Логика скоринга
│   ├── external_sources.py   # Интеграция с внешними сервисами
│   ├── utils.py              # Вспомогательные утилиты
│   └── templates/            # Шаблоны HTML
│       └── index.html        # Веб-интерфейс
├── data/                     # Данные
│   ├── input/                # Входные CSV файлы
│   ├── output/               # Результаты скоринга
│   └── logs/                 # Логи приложения
├── migrations/               # Миграции базы данных (Alembic)
├── tests/                    # Тесты
├── requirements.txt          # Зависимости Python
├── docker-compose.yml        # Docker Compose конфигурация
├── Dockerfile                # Docker конфигурация
├── .env                      # Переменные окружения
└── README.md                 # Документация
```

### Формат загружаемых CSV файлов

Файлы должны быть в кодировке UTF-8, с разделителем запятая. Примеры для разных источников:

#### 1. Общий формат (leads)
```csv
ФИО,Телефон,Дата согласия,Email,Источник
"Иванов Иван Иванович",89161234567,"2024-01-15","ivanov@mail.ru","Реклама"
"Петров Петр Петрович",+7(916)987-65-43,"2024-01-16","petrov@gmail.com","Сайт"
```

#### 2. ФНС (налоговая)
```csv
ИНН,ФИО,Телефон,Адрес,Дата рождения
7707083893,"ИВАНОВ ИВАН ИВАНОВИЧ",8-916-123-45-67,"г. Москва, ул. Ленина, д.1","1985-05-15"
7707083894,"ПЕТРОВ ПЕТР ПЕТРОВИЧ",+7 916 987 65 43,"г. Москва, ул. Мира, д.5","1990-08-20"
```

#### 3. Госуслуги
```csv
ИНН,ФИО,Адрес,Телефон,Email,Регион
7707083893,"Иванов И.И.","г. Москва, ул. Ленина, д.1",89161234567,"ivanov@mail.ru","77"
7707083894,"Петров П.П.","г. Москва, ул. Мира, д.5",89169876543,"petrov@gmail.com","77"
```

#### 4. Службы доставки
```csv
Телефон,Адрес,Имя,Количество заказов,Последний заказ
89161234567,"г. Москва, ул. Ленина, д.1, кв.10","Иван",25,"2024-01-20"
89169876543,"г. Москва, ул. Мира, д.5, кв.25","Петр",15,"2024-01-18"
```

#### 5. Банки
```csv
ИНН,ФИО,Телефон,Email,Сумма кредита,Статус,Дата открытия
7707083893,"Иванов Иван Иванович",+79161234567,"ivanov@mail.ru",500000,"Просрочка","2023-06-15"
7707083894,"Петров Петр Петрович",+79169876543,"petrov@gmail.com",300000,"Норма","2023-08-20"
```

#### 6. Страховые компании
```csv
ФИО,Телефон,Дата рождения,Адрес,Тип полиса,Сумма страховки
"Иванов Иван Иванович",89161234567,"15.05.1985","г. Москва, ул. Ленина, д.1","ОСАГО",25000
"Петров Петр Петрович",89169876543,"20.08.1990","г. Москва, ул. Мира, д.5","КАСКО",150000
```

#### 7. МФО (микрофинансовые организации)
```csv
ФИО,Телефон,ИНН,Сумма займа,Дата займа,Статус погашения,Просрочка дней
"Иванов Иван Иванович",+79161234567,7707083893,50000,"2024-01-01","Не погашен",45
"Петров Петр Петрович",+79169876543,7707083894,25000,"2024-01-05","Погашен",0
```

### Требования к файлам:
1. **Кодировка**: UTF-8
2. **Разделитель**: запятая (,)
3. **Кавычки**: двойные кавычки (") для строк с запятыми или пробелами
4. **Заголовки**: обязательны в первой строке
5. **Пустые значения**: допустимы (будут заменены на NULL)
6. **Даты**: в формате ГГГГ-ММ-ДД или ДД.ММ.ГГГГ
7. **Телефоны**: могут быть в любом формате (система нормализует)
8. **ФИО**: могут быть в любом формате (система нормализует)
9. **Размер файла**: до 10 ГБ

### Процесс работы:
1. Загрузите CSV файлы в папку `data/input/`
2. Запустите обработку через веб-интерфейс
3. Система:
   - Нормализует данные (телефоны, ФИО)
   - Объединяет данные из разных источников
   - Удаляет дубликаты (по ФИО+дата рождения или ИНН)
   - Обогащает данные из внешних источников (ФССП, Федресурс и др.)
   - Рассчитывает скоринг
   - Формирует итоговый файл `scoring_ready.csv`
4. Скачайте результат из раздела "Результаты"

### Пример итогового файла (scoring_ready.csv):
```csv
phone,fio,score,reason_1,reason_2,reason_3,is_target,group
+79165555555,"Сидоров Сидор Сидорович",85.0,"Долг 800000 руб.","Долг перед банком/МФО","Судебный приказ",1,high_score
+79161234567,"Иванов Иван Иванович",75.0,"Долг 350000 руб.","Долг перед банком/МФО","Нет недвижимости",1,high_debt_recent_court
+79164444444,"Кузнецов Кузьма Кузьмич",68.0,"Долг 450000 руб.","Долг перед банком/МФО","Множественные долги (3)",1,medium_score
```